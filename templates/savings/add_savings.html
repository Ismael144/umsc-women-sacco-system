{% extends 'base.html' %}

{% block page_title %}Add Savings{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}"><i class='bx bx-home'></i> Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'savings_accounts' %}">Savings Accounts</a></li>
        <li class="breadcrumb-item active" aria-current="page">Add Savings</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class='bx bx-plus-circle'></i> Add Savings
                </h5>
            </div>
            <div class="card-body">
                <form method="post" class="needs-validation" novalidate>
                    {% csrf_token %}
                    
                    <!-- Savings Details Section -->
                    <div class="form-section">
                        <h6><i class='bx bx-wallet'></i> Savings Details</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.account.id_for_label }}" class="form-label">
                                        Select Account <span class="required">*</span>
                                    </label>
                                    {{ form.account }}
                                    {% if form.account.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.account.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.txn_type.id_for_label }}" class="form-label">
                                        Transaction Type <span class="required">*</span>
                                    </label>
                                    {{ form.txn_type }}
                                    {% if form.txn_type.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.txn_type.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.amount.id_for_label }}" class="form-label">
                                        Amount <span class="required">*</span>
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        {{ form.amount }}
                                    </div>
                                    {% if form.amount.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.amount.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.running_balance.id_for_label }}" class="form-label">
                                        Running Balance
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        {{ form.running_balance }}
                                    </div>
                                    <div class="form-text">Current account balance after transaction</div>
                                    {% if form.running_balance.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.running_balance.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="{{ form.narration.id_for_label }}" class="form-label">
                                Description
                            </label>
                            {{ form.narration }}
                            <div class="form-text">Optional: Add a note about this savings transaction</div>
                            {% if form.narration.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.narration.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Enhanced Savings Information -->
                    <div class="form-section">
                        <h6><i class='bx bx-mobile'></i> Enhanced Savings Details</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.mobile_money_tx_id.id_for_label }}" class="form-label">
                                        Mobile Money Transaction ID
                                    </label>
                                    {{ form.mobile_money_tx_id }}
                                    <div class="form-text">Optional: For mobile money transactions</div>
                                    {% if form.mobile_money_tx_id.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.mobile_money_tx_id.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="{{ form.reference.id_for_label }}" class="form-label">
                                        Reference Number
                                    </label>
                                    {{ form.reference }}
                                    <div class="form-text">Optional: Transaction reference</div>
                                    {% if form.reference.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.reference.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="{% url 'savings_accounts' %}" class="btn btn-secondary">
                                <i class='bx bx-arrow-back'></i> Back to Savings
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class='bx bx-save'></i> Add Savings
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Form loading state
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function() {
            this.classList.add('form-loading');
        });
    });
});
</script>
{% endblock %}
